<!DOCTYPE html>
<html lang="en">
<!--
  Pose Sandbox — GitHub Pages friendly
  - ES Modules + Import Map
  - Three.js + OrbitControls + TransformControls
  - UI + Canvas + Help Modal
  - Pose Gallery (thumbnails) using localStorage (no backend)
  - Preset Poses (built-in, no backend)
-->
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <meta name="description" content="Pose Sandbox: pose a simple 3D character, place props, save/load poses, export PNG." />
  <meta name="theme-color" content="#0b0f17" />
  <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg">
  <link rel="icon" type="image/png" sizes="48x48" href="./assets/favicon.png">

  <title>Pose Sandbox — App</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="./styles.css" />

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>
</head>

<body>
  <header class="topbar" role="banner">
    <div class="brand">
      <div class="brand__mark" aria-hidden="true">◼</div>
      <div class="brand__text">
        <div class="brand__title">Pose Sandbox</div>
        <div class="brand__subtitle">Character posing • Props • Export</div>
      </div>
    </div>

    <div class="topbar__actions">
      <a class="btn btn--ghost" href="./index.html" title="Back to landing">Home</a>

      <button class="btn btn--ghost" id="btnHelp" type="button" aria-haspopup="dialog" aria-controls="helpModal">
        Help
      </button>
      <button class="btn btn--ghost" id="btnPerf" type="button" title="Toggle performance overlay">
        Perf
      </button>
      <button class="btn btn--primary" id="btnExport" type="button" title="Export current view as PNG">
        Export PNG
      </button>
    </div>
  </header>

  <main class="app" role="main">
    <aside class="panel" aria-label="Tools and controls">
      <section class="panel__section">
        <h2 class="panel__title">Selection</h2>
        <div class="hint">
          Click a joint or prop in the 3D view.
          Then use the gizmo.
        </div>

        <div class="row">
          <label class="label" for="selectionName">Selected</label>
          <input id="selectionName" class="input" type="text" value="None" readonly />
        </div>

        <div class="row row--split">
          <button class="btn" id="btnFocus" type="button" title="Frame the selected object">Focus</button>
          <button class="btn" id="btnClear" type="button" title="Clear selection">Clear</button>
        </div>
      </section>

      <section class="panel__section">
        <h2 class="panel__title">Gizmo</h2>

        <div class="row row--split">
          <button class="btn btn--active" id="modeRotate" type="button">Rotate</button>
          <button class="btn" id="modeMove" type="button">Move</button>
        </div>
        <div class="row">
          <button class="btn" id="modeOrbit" type="button">Orbit</button>
        </div>

        <div class="row">
          <label class="label">Axis lock</label>
          <div class="chips" role="group" aria-label="Axis lock">
            <button class="chip chip--active" id="axisX" type="button">X</button>
            <button class="chip chip--active" id="axisY" type="button">Y</button>
            <button class="chip chip--active" id="axisZ" type="button">Z</button>
          </div>
        </div>

        <div class="row">
          <label class="label" for="rotateSnap">Rotate snap</label>
          <select id="rotateSnap" class="select">
            <option value="0">Off</option>
            <option value="5">5°</option>
            <option value="10" selected>10°</option>
            <option value="15">15°</option>
            <option value="30">30°</option>
            <option value="45">45°</option>
          </select>
        </div>

        <div class="row">
          <label class="label">Visual aids</label>
          <div class="toggles">
            <label class="toggle"><input id="togGrid" type="checkbox" checked /><span>Grid</span></label>
            <label class="toggle"><input id="togAxes" type="checkbox" /><span>Axes</span></label>
            <label class="toggle"><input id="togOutline" type="checkbox" checked /><span>Outline</span></label>
          </div>
        </div>
      </section>

      <section class="panel__section">
        <h2 class="panel__title">Pose</h2>

        <div class="row row--split">
          <button class="btn" id="btnResetPose" type="button" title="Reset joint rotations">Reset</button>
          <button class="btn" id="btnRandomPose" type="button" title="Randomize pose (mild)">Random</button>
        </div>

        <div class="row row--split">
          <button class="btn btn--primary" id="btnSavePose" type="button" title="Download pose.json AND save thumbnail to gallery">
            Save JSON
          </button>
          <button class="btn" id="btnLoadPose" type="button" title="Load pose.json from your computer">Load JSON</button>
          <input id="filePose" type="file" accept=".json" hidden />
        </div>

        <div class="row">
          <button class="btn" id="btnSaveGallery" type="button" title="Save pose to gallery (no download)">
            Save to Gallery
          </button>
        </div>

        <div class="row">
          <label class="label" for="poseNotes">Notes</label>
          <textarea id="poseNotes" class="textarea" rows="3" placeholder="Optional: write pose notes..."></textarea>
        </div>
      </section>

      <!-- ✅ NEW: Preset Poses -->
      <section class="panel__section">
        <h2 class="panel__title">Preset Poses</h2>
        <div class="hint">
          Built-in starter poses. Select one, then apply it. (Joints only — your props won’t be deleted.)
        </div>

        <div class="row">
          <div id="presetGallery" class="poseGallery" aria-label="Preset pose list"></div>
        </div>

        <div class="row row--split">
          <button class="btn" id="btnPresetApply" type="button" title="Apply selected preset (joints only)">
            Apply Preset
          </button>
          <button class="btn" id="btnPresetSave" type="button" title="Save selected preset into your Gallery (creates a thumbnail)">
            Save to Gallery
          </button>
        </div>
      </section>

      <section class="panel__section">
        <h2 class="panel__title">Pose Gallery</h2>

        <div class="row row--split">
          <button class="btn" id="btnRenamePose" type="button" title="Rename selected gallery pose">Rename</button>
          <button class="btn" id="btnDeletePose" type="button" title="Delete selected gallery pose">Delete</button>
        </div>

        <div class="row">
          <button class="btn" id="btnClearGallery" type="button" title="Clear all saved gallery poses">
            Clear Gallery
          </button>
        </div>

        <div class="hint">
          Click a thumbnail to load. Saved locally in your browser (persists after refresh).
        </div>

        <div id="poseGallery" class="poseGallery" aria-label="Saved pose thumbnails"></div>
      </section>

      <section class="panel__section">
        <h2 class="panel__title">Props</h2>
        <div class="hint">Basic decorations you can pose too.</div>

        <div class="row row--split">
          <button class="btn" id="btnAddCube" type="button">Add Cube</button>
          <button class="btn" id="btnAddSphere" type="button">Add Sphere</button>
        </div>

        <div class="row row--split">
          <button class="btn" id="btnDelProp" type="button" title="Delete selected prop (if prop)">Delete</button>
          <button class="btn" id="btnScatter" type="button" title="Scatter a few props">Scatter</button>
        </div>

        <div class="row">
          <label class="label" for="bgTone">Background</label>
          <select id="bgTone" class="select">
            <option value="midnight" selected>Midnight</option>
            <option value="studio">Studio</option>
            <option value="graphite">Graphite</option>
          </select>
        </div>
      </section>

      <section class="panel__section panel__section--footer">
        <div class="tiny">
          Tip: <kbd>1</kbd>/<kbd>2</kbd>/<kbd>3</kbd> = Rotate/Move/Orbit • <kbd>Esc</kbd> clears selection • <kbd>F</kbd> focus • <kbd>Del</kbd> deletes prop
        </div>
        <div class="tiny tiny--muted">Built for GitHub Pages. No bundler. No nonsense.</div>
      </section>
    </aside>

    <section class="viewport" aria-label="3D viewport">
      <canvas id="c" class="canvas" aria-label="3D canvas"></canvas>

      <div id="errorOverlay" class="error hidden" role="alert">
        <div class="error__title">Render failed</div>
        <pre id="errorText" class="error__text"></pre>
      </div>

      <div class="toast" id="toast" aria-live="polite"></div>
    </section>
  </main>

  <!-- Help modal -->
  <div class="modal hidden" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="modal__backdrop" data-close="true"></div>
    <div class="modal__card">
      <div class="modal__header">
        <h3 id="helpTitle" class="modal__title">Help</h3>
        <button class="iconbtn" id="btnCloseHelp" type="button" aria-label="Close help">✕</button>
      </div>
      <div class="modal__body">
        <ul class="help">
          <li><b>Select:</b> click a joint or prop in the 3D view.</li>
          <li><b>Rotate:</b> use the gizmo rings. Toggle axes X/Y/Z. (<kbd>1</kbd>)</li>
          <li><b>Move:</b> switch to Move to translate the selected joint/prop. (<kbd>2</kbd>)</li>
          <li><b>Orbit:</b> use Orbit mode to move camera freely. (<kbd>3</kbd>)</li>
          <li><b>Save JSON:</b> downloads pose.json AND saves a thumbnail in gallery.</li>
          <li><b>Save to Gallery:</b> saves locally without downloading.</li>
          <li><b>Export:</b> downloads a PNG of the current view.</li>
        </ul>
        <div class="help__note">
          If your screen is blank, hard-refresh (<kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>R</kbd>) and check Console.
        </div>
      </div>
      <div class="modal__footer">
        <button class="btn btn--primary" id="btnHelpOk" type="button">Got it</button>
      </div>
    </div>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
